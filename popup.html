<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SEI Smart</title>
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <main>
      <header class="top-bar">
        <div class="header-content">
          <h1>ğŸ§  SEI Smart</h1>
          <p class="header-subtitle">Assistente inteligente para seus despachos</p>
        </div>
      <div class="header-buttons">
        <button
          id="openCreditsButton"
          type="button"
          class="icon-button"
          aria-label="Ver crÃ©ditos"
          title="Ver crÃ©ditos"
        >
          <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
            <path
              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
            />
          </svg>
        </button>
        <button
          id="openOptionsButton"
          type="button"
          class="icon-button"
          aria-label="Abrir configuraÃ§Ãµes"
          title="Abrir configuraÃ§Ãµes"
        >
          <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
            <path
              d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm8.94-3.5c0-.59-.05-1.17-.15-1.73l2.03-1.58a1 1 0 0 0 .24-1.32l-1.92-3.32a1 1 0 0 0-1.2-.45l-2.39.96a7.96 7.96 0 0 0-1.5-.87l-.36-2.55A1 1 0 0 0 14.75 1h-3.5a1 1 0 0 0-.99.84l-.36 2.55c-.54.21-1.05.48-1.53.8l-2.38-.95a1 1 0 0 0-1.2.45L2.88 7.01a1 1 0 0 0 .24 1.32l2.02 1.57c-.08.56-.14 1.15-.14 1.75s.05 1.19.14 1.75l-2.02 1.57a1 1 0 0 0-.24 1.32l1.92 3.32a1 1 0 0 0 1.2.45l2.38-.95c.48.32.99.59 1.53.8l.36 2.55a1 1 0 0 0 .99.84h3.5a1 1 0 0 0 .99-.84l.36-2.55c.53-.21 1.03-.48 1.5-.87l2.39.96a1 1 0 0 0 1.2-.45l1.92-3.32a1 1 0 0 0-.24-1.32l-2.03-1.58c.1-.56.15-1.14.15-1.73Z"
            />
          </svg>
        </button>
      </div>
      </header>

      <div class="document-type-section">
        <div class="document-type-selector">
          <label class="toggle-option">
            <input type="radio" name="documentType" value="response" checked>
            <span class="toggle-text">
              <span class="toggle-label"> ğŸ“„ Resposta a Documento</span>
              <span class="toggle-description">Responder a um despacho recebido</span>
            </span>
          </label>
          <label class="toggle-option">
            <input type="radio" name="documentType" value="new">
            <span class="toggle-text">
              <span class="toggle-label">âœ¨ Novo Documento</span>
              <span class="toggle-description">Criar documento do zero</span>
            </span>
          </label>
        </div>
      </div>

      <div class="form-group" id="responseModeFields">     
        <div id="captureSourceSection" class="capture-source-section" hidden>
          <div style="display: flex; align-items: center;">
            <label for="captureSourceTab" style="margin-bottom: 0; flex: 1;">ğŸ“¥ Capturar de qual janela?</label>
            <button id="captureTextButton" type="button" class="capture-button" style="margin-left: auto; margin-top: 8px;">
              ğŸ“¸ Capturar Lista de Janelas
            </button>
          </div>

          <select id="captureSourceTab" class="target-select">
            <option value="">Carregando janelas...</option>
          </select>
          <div class="capture-actions">
            <button id="confirmCaptureButton" type="button" class="btn-capture-confirm">
              âœ… Capturar Texto do Documento
            </button>
          </div>
          <div class="form-group">
            <label for="dispatchText">ğŸ“„ Texto do Documento Recebido</label>
            <p class="field-hint">Sempre selecione o documento recebido na janela de origem antes de capturar o texto.</p>
            <textarea id="dispatchText" 
            placeholder="Cole aqui o texto do despacho que vocÃª recebeu..." rows="4"></textarea>
          </div>
        </div>
      </div>


      <div class="form-group" id="documentModelGroup">
        <label for="documentModelSelect">ğŸ“ Modelo de Documento</label>
        <div class="custom-select-container">
          <select id="documentModelSelect" class="document-model-select">
            <option value="despacho-padrao">ğŸ“„ Despacho PadrÃ£o</option>
            <option value="oficio-padrao">ğŸ“‹ OfÃ­cio PadrÃ£o</option>
            <option value="memorando-padrao">ğŸ“ Memorando PadrÃ£o</option>
          </select>
          <div class="select-arrow">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
        </div>
        <div class="model-preview" id="modelPreview">
          <div class="preview-header">
            <span class="preview-label">ğŸ‘ï¸ Preview do Modelo:</span>
            <button type="button" class="preview-toggle" id="previewToggle">ğŸ”½</button>
          </div>
          <div class="preview-content" id="previewContent" style="display: none;">
            <pre id="previewText">Carregando preview...</pre>
          </div>
        </div>
        <p class="field-hint">Escolha o modelo que melhor se adequa ao seu documento</p>
      </div>      

      <div class="form-group" id="documentNameGroup">
        <label for="documentName">ğŸ“‹ Nome do Documento (opcional)</label>
        <input
          type="text"
          id="documentName"
          placeholder="Ex: DESPACHO 123/STC"
        />
        <p class="field-hint">Nome/tÃ­tulo do documento que serÃ¡ gerado</p>
      </div>

      <div class="form-group" id="newDocumentFields" style="display: none;">
        <div class="form-group">
        <label for="newDocumentContext">ğŸ“ Contexto do Novo Documento</label>
        <div style="display: flex; align-items: flex-start; gap: 8px;">
          <button id="fillContextExampleButton" type="button" class="icon-button" title="Preencher com exemplo padrÃ£o" style="margin-bottom: 8px; margin-right: 6px; align-self: flex-start;">
            <span style="font-size: 1.1em;">âœ¨</span>
          </button>
          <textarea
            id="newDocumentContext"
            placeholder="Descreva o contexto do novo documento:

Exemplo:
SituaÃ§Ã£o: Processo administrativo sobre licitaÃ§Ã£o
DestinatÃ¡rio: Secretaria de AdministraÃ§Ã£o
Objetivo: Solicitar esclarecimentos sobre documentaÃ§Ã£o
Contexto: O processo 12345/2024 foi protocolado com documentos incompletos. NecessÃ¡rio solicitar complementaÃ§Ã£o da documentaÃ§Ã£o fiscal e tÃ©cnica.
Prazo: 30 dias"
            rows="5"
            style="flex: 1;"
          ></textarea>
        </div>
        </div>
        <p class="field-hint">Descreva detalhadamente o destinatÃ¡rio, objetivo e contexto do documento</p>
      </div>

      <div class="form-group" id="additionalContextFields">
        <label for="promptExtra">ğŸ’¡ Contexto Adicional (opcional)</label>
        <textarea
          id="promptExtra"
          placeholder="Adicione informaÃ§Ãµes extras como forma de escrita, objetividade, detalhado ou curto, inclur legislaÃ§Ã£o ou nÃ£o, etc."
          rows="3"
        ></textarea>
      </div>

      <div class="actions">
        <button id="generateButton" type="button" class="primary-button">
          âœ¨ Gerar Texto Sugerido com IA
        </button>
        <button id="writeManuallyButton" type="button" class="secondary-button">
          âœï¸ Escrever Manualmente
        </button>
      </div>

      <p id="statusMessage" role="status" aria-live="polite"></p>

      <section id="resultSection" hidden>
        <div class="result-header">
          <h2 id="resultTitle">âœ… Resposta Sugerida</h2>
          <p class="edit-hint" id="resultHint">ğŸ’¡ VocÃª pode editar o texto antes de usar</p>
        </div>
        <textarea id="responseText" class="response-textarea" placeholder="Digite ou cole seu texto aqui..."></textarea>
        
        <div class="form-group">
          <div class="label-with-action">
            <label for="targetTab">ğŸ¯ Janela de Destino</label>
            <button id="reloadTargetTabsButton" type="button" class="capture-button" title="Recarregar lista de janelas">
              ğŸ”„ Atualizar
            </button>
          </div>
          <select id="targetTab" class="target-select">
            <option value="">Detectar automaticamente</option>
          </select>
          <p class="field-hint">Selecione em qual janela do SEI deseja colar a resposta</p>
        </div>

        <button id="useResponseButton" type="button" class="use-button">
          ğŸ“‹ Usar esta resposta no despacho
        </button>
      </section>

      <!-- Modal de CrÃ©ditos -->
      <div id="creditsModal" class="credits-modal" hidden>
        <div class="sei-credits-overlay sei-credits-open">
          <div id="creditsContainer" class="sei-credits-card-wrapper"></div>
        </div>
      </div>
    </main>
    <script src="credits-template.js"></script>
    <script type="module" src="popup.js"></script>
  </body>
</html>
